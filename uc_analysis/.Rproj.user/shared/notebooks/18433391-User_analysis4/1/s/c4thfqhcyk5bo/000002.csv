"0","#1daily activity pvuv"
"0","pvuv_sql = paste0(""select dt,"
"0","                 count(1) uv,"
"0","                 sum(pv) pv ,"
"0","                 sum(pv)/count(1) perpv,"
"0","                 count(if(isnew='new',1,null)) newuv ,"
"0","                 sum(if(isnew='new',pv,0)) newpv, "
"0","                 sum(if(isnew='new',pv,0))/count(if(isnew='new',1,null)) newperpv,"
"0","                 count(if(isnew='old',1,null)) olduv ,"
"0","                 sum(if(isnew='old',pv,0)) oldpv, "
"0","                 sum(if(isnew='old',pv,0))/count(if(isnew='old',1,null)) oldperpv"
"0","                 from "
"0","                 dl.umid_pv where dt>='"",ldatestart.str,"
"0","                 ""'group by dt"")"
"0","mpvuv = read_data_impala_general(pvuv_sql)"
"0","mpvuv = mpvuv[order(mpvuv$dt),]"
"0","xlarge = nrow(mpvuv)"
"0","xmid = floor(xlarge/2+0.5)+1"
"0","pvuv = mpvuv[xmid:xlarge,]"
"0","wpvuv = pvuv"
"0","pvuv$fdt = as.factor(pvuv$dt)"
"0","matrix = as.matrix(cbind(newuv = pvuv$newuv,olduv = pvuv$olduv))"
"0","matrix = t(matrix)"
"0","maxy = max(pvuv$uv)"
"0","maxx = pvuv[which.max(pvuv$uv),""dt""]"
"0","meany = mean(pvuv$uv)"
"0","newbetterthanold = sum(pvuv$newuv>pvuv$olduv)"
"0","abnormalhighdt = pvuv[pvuv$uv>1.3*meany,""dt""]"
"0","abnormallowdt = pvuv[pvuv$uv<0.7*meany,""dt""]"
"0","par(bg = 'white')"
"0","colors <- c(""green"",""red"")"
"0","dates <- pvuv$dt"
"0","stacks <- c(""Old"",""New"")"
"0","# Create the bar chart."
"0","# barplot(matrix,main=""Every day uv"",names.arg=dates,xlab=""month"",ylab=""uv"",col=colors)"
"0","# Add the legend to the chart."
"0","# legend(x = 0,y = maxy, stacks, cex=0.7, fill=colors,xjust = 0, yjust = 1)"
"0","bplot = barplot(matrix,main=""Every day uv"",names.arg=dates,xlab=""month"",ylab=""uv"",col=colors,legend.text = stacks,args.legend = list(x = 0,y = maxy, stacks, cex=0.7, fill=colors,xjust = 0, yjust = 1))"
