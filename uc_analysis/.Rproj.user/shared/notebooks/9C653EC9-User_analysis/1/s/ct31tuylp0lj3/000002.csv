"0","new_user_by_model_date_city_sql = "
"0","paste0(""select count(b.u_mid) numbers,firstdt,d_model,l_city from"
"0","(select f.u_mid,substr(firstonlinetime,1,10) firstdt,a.d_model,a.l_city from dl.umid_firstonlinetime f left join"
"0","  (select distinct u_mid,d_model,l_city from ods.ods_app_pageview_info where dt>= "",datestart.str,"") a"
"0","  using(u_mid) where substr(firstonlinetime,1,10) >= '"",as.character(datestart),""' "
"0","  and f.dt = '"",dateend.str,""') b group by firstdt,d_model,l_city"")"
"0","new_user_by_model_date_city = read_data_impala_general(new_user_by_model_date_city_sql)"
"0","new_user_by_model_date_city = data.table(new_user_by_model_date_city)"
"0","new_user_by_model_date = new_user_by_model_date_city[d_model!=""null"" & str_trim(d_model)!="""",.(numbers = sum(numbers)),by = c(""d_model"",""firstdt"")]"
"0","new_user_by_model = new_user_by_model_date_city[d_model!=""null"" & str_trim(d_model)!="""",.(numbers = sum(numbers)),by = ""d_model""][order(numbers,decreasing = T)]"
"0","model_list = new_user_by_model[1:100,]$d_model"
"0","new_user_by_model_date_top100 = new_user_by_model_date[d_model %in% model_list,]"
"0","new_user_by_model_date_top100$model = factor(new_user_by_model_date_top100$d_model,levels = model_list)"
"0","new_user_by_model_date_top100_ordered = new_user_by_model_date_top100[order(firstdt,model)]"
"0","new_user_by_model_date_ordered_reshape = reshape(new_user_by_model_date_top100_ordered, idvar = ""model"", timevar = ""firstdt"", direction = ""wide"")"
"0","new_user_by_model_date_ordered_reshape = dcast(new_user_by_model_date_top100_ordered, model ~ firstdt, value.var = ""numbers"")"
"0","new_user_by_model_date_ordered_reshape$sum =rowSums(new_user_by_model_date_ordered_reshape[,-1],na.rm = T)"
"0","# kable(new_user_by_model_date_ordered_reshape)"
"0","DT::datatable(new_user_by_model_date_ordered_reshape, options = list(pageLength = 20))"
