"0","  survival_sql = paste0(""select "
"0","  a.dt,ndv(a.u_mid) t,"
"0","  ndv(case when datediff(concat(substr(b.dt,1,4),'-',substr(b.dt,5,2),'-',substr(b.dt,7,2)),"
"0","  concat(substr(a.dt,1,4),'-',substr(a.dt,5,2),'-',substr(a.dt,7,2)))=1 then a.u_mid else null end)	t1,"
"0","  ndv(if(a.isnew='new',a.u_mid,null)) newuv ,"
"0","  ndv(case when datediff(concat(substr(b.dt,1,4),'-',substr(b.dt,5,2),'-',substr(b.dt,7,2)),"
"0","  concat(substr(a.dt,1,4),'-',substr(a.dt,5,2),'-',substr(a.dt,7,2)))=1 and a.isnew='new' then a.u_mid else null end) newt1,"
"0","  ndv(if(a.isnew='old',a.u_mid,null)) olduv,"
"0","  ndv(case when  datediff(concat(substr(b.dt,1,4),'-',substr(b.dt,5,2),'-',substr(b.dt,7,2)),"
"0","  concat(substr(a.dt,1,4),'-',substr(a.dt,5,2),'-',substr(a.dt,7,2)))=1  and a.isnew='old' then a.u_mid else null end) noldt1"
"0","  from dl.umid_pv a"
"0","  left outer join"
"0","  dl.umid_pv b on a.u_mid=b.u_mid		"
"0","  where  a.dt>='"",datestart.str,""' group by a.dt"")"
"2","Warning message:
"
"2","In strsplit(code, ""\n"", fixed = TRUE) :"
"2","
 "
"2"," input string 1 is invalid in this locale
"
"0","survival = read_data_impala_general(survival_sql)"
"0","survival = survival[order(survival$dt),]"
"0","par(bg = 'black')"
"0","colors = rainbow(3)"
"0","#考虑survival,!!须注意最后一天"
"0","ylarge = max(max(survival$t1/survival$t),max(survival$newt1/survival$newuv),max(survival$noldt1/survival$olduv))"
"0","plot(survival$dt,survival$t1/survival$t,col = colors[[1]],type = 'l',ylim = c(0,ceiling(ylarge)))"
