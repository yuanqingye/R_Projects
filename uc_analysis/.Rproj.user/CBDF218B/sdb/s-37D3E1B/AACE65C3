{
    "collab_server" : "",
    "contents" : "---\ntitle: \"User_analysis_1020\"\nauthor: \"qingye\"\ndate: \"2017年10月20日\"\noutput: html_document\n---\n#本报告对10月8日用户至10月19日节后这两周的行为进行了分析\n####包括反映用户数目的UV,反映用户活跃度的：人均PV,用户活跃时长，以及反映用户黏度的次日留存\n####本次报告初步用R语言进行自动化生成报告的框架搭建，今后将在此基础上不断改进优化，下次报告将加入转化方面的分析，加入对于路径方面的分析，引进异常值提醒和分析\n```{r setup, include=FALSE}\nknitr::opts_chunk$set(echo = FALSE)\nlibrary(readxl)\nlibrary(knitr)\nlibrary(xtable)\ndateend = Sys.Date()-1\ndatestart = Sys.Date()-14\ndatestart.str = format(datestart,'%Y%m%d')\ndateend.str = format(dateend,'%Y%m%d')\ndates = datestart.str:dateend.str\n```\n\n\n##近两周的日活跃度(UV)\n```{r daily_pvuv,echo = FALSE}\nsource('~/Rfile/R_impala.R')\n#1daily activity pvuv\npvuv_sql = paste(\"select dt,\ncount(1) uv,\nsum(pv) pv ,\nsum(pv)/count(1) perpv,\ncount(if(isnew='new',1,null)) newuv ,\nsum(if(isnew='new',pv,0)) newpv, \nsum(if(isnew='new',pv,0))/count(if(isnew='new',1,null)) newperpv,\ncount(if(isnew='old',1,null)) olduv ,\nsum(if(isnew='old',pv,0)) oldpv, \nsum(if(isnew='old',pv,0))/count(if(isnew='old',1,null)) oldperpv\nfrom \ndl.umid_pv where dt>=\",datestart.str,\n\"group by dt\")\n\npvuv = read_data_impala_general(pvuv_sql)\npvuv = pvuv[order(pvuv$dt),]\n\n#考虑日活动量\npar(bg = 'black')\ncolors = rainbow(3)\nplot(pvuv$dt,pvuv$uv,col = colors[[1]],type = 'l',ylim = c(0,70000))\nlines(pvuv$dt,pvuv$newuv,col = colors[[2]],type = 'l')\nlines(pvuv$dt,pvuv$olduv,col = colors[[3]], type = 'l')\n\nlegend('topleft',c(\"uv\",\"newuv\",\"olduv\"),cex = 0.7,fill = colors,text.col= 'pink')\n\n#需要加入坐标轴\ntitle(main = '近两周日活',xlab = 'dates',ylab = '日活',col.main = 'blue',\n      col.lab = 'purple')\naxis(1,col = 'purple')\nat = axTicks(1)\nmtext(side = 1, text = at, at = at, col = \"purple\", line = 1)\n\naxis(2,col = 'purple')\nat = axTicks(2)\nmtext(side = 2,text = at,at = at,col = 'purple',line = 1)\n```\n\n不出意料的是节日过后，uv马上冷却下来\n\n不过从10月16日开始uv有回暖趋势，并在17日有个小高峰\n\n访问人数上，还是老用户多一些，新老用户的趋势并无大的不同\n\n##近两周人均PV\n```{r pv_perperson,echo = FALSE}\npar(bg = 'black')\ncolors = rainbow(3)\nylarge = max(max(pvuv$perpv),max(pvuv$newperpv),max(pvuv$oldperpv))\n#考虑人均pv\nplot(pvuv$dt,pvuv$perpv,col = colors[[1]],type = 'l',ylim = c(0,ceiling(ylarge)))\nlines(pvuv$dt,pvuv$newperpv,col = colors[[2]],type = 'l')\nlines(pvuv$dt,pvuv$oldperpv,col = colors[[3]], type = 'l')\n\nlegend('topright',c(\"perpv\",\"newperpv\",\"oldperpv\"),cex = 0.7,fill = colors,text.col= 'pink')\n\n#需要加入坐标轴\ntitle(main = '近两周人均pv',xlab = 'dates',ylab = '人均pv',col.main = 'blue',\n      col.lab = 'purple')\naxis(1,col = 'purple')\nat = axTicks(1)\nmtext(side = 1, text = at, at = at, col = \"purple\", line = 1)\n\naxis(2,col = 'purple')\nat = axTicks(2)\nmtext(side = 2,text = at,at = at,col = 'purple',line = 1)\n```\n\n节后迅速下跌，不过之后就开始回暖，到10月16日有个峰值\n\n新用户峰值出现在15日，老用户峰值出现在16日，有一天的滞后\n\n老用户比新用户在这个指标上要更显著更活跃一些\n\n## 用户活跃时长\n```{r time_span, echo=FALSE}\ntime_span = read_xlsx(\"~/data/uc_analysis/time_span.xlsx\")\npar(bg = 'black')\ncolors = rainbow(3)\nylarge = max(time_span[,2:4])\nplot(time_span$dt,time_span$totalavg,col = colors[[1]],type = 'l',ylim = c(0,ceiling(ylarge)))\nlines(time_span$dt,time_span$newavg,col = colors[[2]],type = 'l')\nlines(time_span$dt,time_span$oldavg,col = colors[[3]], type = 'l')\n\nlegend('topright',c(\"totalavg\",\"newavg\",\"oldavg\"),cex = 0.7,fill = colors,text.col= 'pink')\n\n#需要加入坐标轴\ntitle(main = '近两周用户活跃时长',xlab = 'dates',ylab = '',col.main = 'blue',\n      col.lab = 'purple')\naxis(1,col = 'purple')\nat = axTicks(1)\nmtext(side = 1, text = at, at = at, col = \"purple\", line = 1)\n\naxis(2,col = 'purple')\nat = axTicks(2)\nmtext(side = 2,text = at,at = at,col = 'purple',line = 1)\n```\n\n在平均活跃时长方面，新老用户的峰值有一天的滞后，新用户峰值出现在15日，老用户16日\n\n老用户整体比新用户平均时长更长，但是在15号当天，新用户达到峰值且超过了老用户\n\n## 次日留存\n```{r survival,echo=FALSE}\nsurvival = read_xlsx(\"~/data/uc_analysis/survival.xlsx\")\nsurvival = survival[-12,]\npar(bg = 'black')\ncolors = rainbow(3)\n\n#考虑survival,!!须注意最后一天\nylarge = max(max(survival$t1/survival$t),max(survival$newt1/survival$newuv),max(survival$noldt1/survival$olduv))\nplot(survival$a.dt,survival$t1/survival$t,col = colors[[1]],type = 'l',ylim = c(0,ceiling(ylarge)))\nlines(survival$a.dt,survival$newt1/survival$newuv,col = colors[[2]],type = 'l')\nlines(survival$a.dt,survival$noldt1/survival$olduv,col = colors[[3]], type = 'l')\n\nlegend('topright',c(\"survival\",\"newsurvival\",\"oldsurvival\"),cex = 0.7,fill = colors,text.col= 'pink')\n\n#需要加入坐标轴\ntitle(main = '近两周次日留存率',xlab = 'dates',ylab = '留存率',col.main = 'blue',\n      col.lab = 'purple')\naxis(1,col = 'purple')\nat = axTicks(1)\nmtext(side = 1, text = at, at = at, col = \"purple\", line = 1)\n\naxis(2,col = 'purple')\nat = axTicks(2)\nmtext(side = 2,text = at,at = at,col = 'purple',line = 1)\n\n```\n\n留存率节后缓慢上升，但是在17日有个比较明显的下降，可能需要调查下原因\n\n\n##新用户不同机型分布\n```{r model,echo = FALSE}\nmodel = read_xlsx(\"~/data/uc_analysis/model.xlsx\")\nkable(model)\n#kable(model,format = \"markdown\")\n```\n\niphone 在国庆最后一天有很多新用户，但是节日过后大幅减少，反倒不如一些普通的android,尤其是iphone 5 系列,\n\niphone 6, iphone 6 plus, 仍然有一定的增加，除了节日，排名前50的手机差别不大，\n\n当然要深入洞察需要对不同机型用户的行为进行分析\n\n\n##新用户不同城市分布\n```{r city,echo = FALSE}\ncity = read_xlsx(\"~/data/uc_analysis/city.xlsx\")\n#kable(city)\nkable(city,format = \"markdown\")\n```\n\n新用户集中在长江三角洲地区，北京，东北地区，成渝地区，华南也有一些\n\n华中西部相对较少\n\n要洞察不同地区用户的特点，需要研究他们的线上和线下的行为\n\n##新用户不同渠道分布\n```{r channel,echo = FALSE}\nchannel = read_xlsx(\"~/data/uc_analysis/channel.xlsx\")\nkable(channel)\n#kable(channel,format = \"markdown\")\n```\n\n从表格上看360手机助手和30015排名前两位且领先优势巨大\n\n然后是二维码和各种应用商店\n",
    "created" : 1508487589372.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "4088229111",
    "id" : "AACE65C3",
    "lastKnownWriteTime" : 1508739320,
    "last_content_update" : 1508739321000,
    "path" : "~/R_Projects/uc_analysis/Rfile/User_analysis_1020.rmd",
    "project_path" : "Rfile/User_analysis_1020.rmd",
    "properties" : {
        "last_setup_crc32" : "",
        "tempName" : "Untitled1"
    },
    "relative_order" : 14,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_markdown"
}