{
    "collab_server" : "",
    "contents" : "library(rvest)\nlibrary(data.table)\nlibrary(magrittr)\n\nget_douban_book_list = function(){\nweb<-read_html(\"https://book.douban.com/top250?icn=index-book250-all\",encoding=\"UTF-8\")\nbook_list = web%>%html_nodes('p.pl')%>%html_text()\nmonth = 2\nyear = 2015\nurl = paste0('https://www.timeanddate.com/weather/china/suzhou/historic?month=',month,'&year=',year)\nweb2 = read_html(url,encoding = 'UTF-8')\nreturn(book_list)\n}\n\nget_ateam_example = function(){\nateam = read_html(\"http://www.boxofficemojo.com/movies/?id=ateam.htm\",encoding = 'UTF-8')\nv1 = ateam%>%html_nodes('center')%>%html_nodes('td')\nv2 = ateam%>%html_nodes('center')%>%html_nodes('font')\nlibrary(magrittr)\nimgs = ateam%>%html_nodes('table')%>%extract2(1)%>%html_nodes('img')\n}\n\nget_3A_hospitals = function(){\n  url = \"http://www.fudanmed.com/institute/news2015-2.aspx\"\n  web = read_html(url,encoding = 'UTF-8')\n  table = web%>%html_nodes('table#table10')%>%html_nodes('table')\n  hospital_list = web%>%html_nodes('table#table10')%>%html_nodes('table')%>%html_nodes('tr')%>%html_text()\n  hospital_list_final = gsub('\\\\s','',hospital_list)\n}\n\nget_3A_hospitals2 = function(){\n  url = 'http://www.fudanmed.com/institute/news2015-2.aspx'\n  web = readLines(url,encoding = 'UTF-8')\n  tables = readHTMLTable(web, as.data.frame = TRUE, stringsAsFactors = FALSE)\n}\n\n# get_business_region = function(url = 'https://www.dianping.com/beijing'){\n#   web = read_html(url,encoding = 'UTF-8')\n# # business_region = web%>%html_nodes('ul#hotregion')%>%html_nodes('li')%>%html_text()\n#   business_region = web%>%html_nodes('ul#hotregion')%>%html_nodes('li>a')%>%html_attr('title')\n#   business_link = web%>%html_nodes('ul#hotregion')%>%html_nodes('li>a')%>%html_attr('href')\n#   business_link = paste0('https://www.dianping.com',business_link)\n#   dt = data.table(region = business_region,link = business_link)\n#   return(dt)\n# }\n\nget_business_shop_info = function(url = 'https://www.dianping.com/search/category/2/0/r1467'){\n  web = read_html(url,encoding = 'UTF-8')\n# business_shop_name = web %>% html_nodes('div#shop-all-list') %>% html_nodes('div.tit>a')%>%extract2(1)%>%html_attr('title')\n# business_shop_name = web %>% html_nodes('div#shop-all-list') %>% html_nodes('div.tit')%>%html_nodes('a')%>%extract2(1)%>%html_attr('title')\n  business_shop_name = web %>% html_nodes('div#shop-all-list') %>% html_nodes('div.tit')%>%html_node('a')%>%html_attr('title')\n  business_shop_addr = web %>% html_nodes('div#shop-all-list') %>% html_nodes('div.tag-addr>span.addr') %>%html_text()\n  dt = data.table(name = business_shop_name,address = business_shop_addr)\n  return(dt)\n}\n\ndianping_scrapper = function(city_list){\n  v = vector(mode = 'character',length = 0)\n  result_dt = data.table(city=v,region = v,name = v,address = v)\n  for(city in city_list){\n    city_url = paste0('https://www.dianping.com/',city)\n    region_dt = get_business_region(city_url)\n    for(i in 1:nrow(region_dt)){\n      region_link = region_dt[[i,\"link\"]]\n      region = region_dt[[i,\"region\"]]\n      shop_dt = get_business_shop_info(region_link)\n      shop_dt[,c('city','region') := list(city,region)]\n      result_dt = rbind(result_dt,shop_dt)\n    }\n  }\n  return(result_dt)\n}\n\nlibrary(compiler)\nc_dianping_scrapper = cmpfun(dianping_scrapper)\n\nget_business_region2 = function(url = 'https://www.dianping.com/shopall/2/0#BDBlock'){\n web = read_html(url,encoding = 'UTF-8')\n business_region2 = web%>%html_nodes('div .box.shopallCate')%>%extract2(2)%>%html_nodes('li>a.B')%>%html_text()\n return(business_region2)\n}\n\ndianping_scrapper2 = function(city_list){\n  v = vector(mode = 'character',length = 0)\n  result_dt = data.table(city=v,region = v)\n  i = 1\n  for(city in city_list){\n    city_url = paste0('https://www.dianping.com/',city)\n    web = read_html(city_url,encoding = 'UTF-8')\n    # business_groups_link = web%>%html_nodes('ul#hotregion')%>%html_nodes('li>a.more')%>%html_attr('href')\n    business_groups_link = web%>%html_nodes('div.cata-hot-detail.cata-hot-area')%>%html_nodes('div.hot-title')%>%html_nodes('a.hot-title-link')%>%html_attr('href')\n    business_groups_link = paste0('https:',business_groups_link)\n    business_region2 = get_business_region2(business_groups_link)\n    temp_dt = data.table(city = city,region = business_region2)\n    result_dt = rbind(result_dt,temp_dt)\n    print(i)\n    i = i+1\n    }\n  return(result_dt)\n}\n\nfang_scrapper = function(city_list){\n  v = vector(mode = 'character',length = 0)\n  result_dt = data.table(name=v,city=v,district = v,location=v,onsaledate = v,unitprice = v)\n  for(city in city_list){\n    for(i in 1:10){\n    url = paste0(\"https://xf.fangdd.com/\",city,\"/loupan/s5-pg\",i)\n    web = read_htmls(url,encoding = 'UTF-8')\n    name = web%>%html_nodes('ul#houslist>span.hsname')%>%html_text()\n    district = web%>%html_nodes('ul#houslist>span.hsname')%>%html_text()\n    }\n  }\n}\n\ntemp = dirname(rstudioapi::getActiveDocumentContext()$path)\n# test <- read_html(\"http://www.privacyrights.org/data-breach/new?title=\")\n# test %>% html_table(html_nodes(\"table.data-breach-table\")[[1]])\n\n# book_list_df = read.table(text = book_list,sep = \"/\")\n# book_list_df = data.table(book_list)\n# \n# str_split(book_list,pattern = \"/\")\n# apply(book_list_df,1,str_split,\"/\")\n# \n# url = \"http://www.360doc.com/content/15/0605/00/22099567_475741839.shtml\"\n# web = read_html(url)\n# table = web%>%html_nodes(\"table\")%>%`[[`(3)%>%html_table(header = TRUE)\n",
    "created" : 1498011051816.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "1000501952",
    "id" : "71A533AC",
    "lastKnownWriteTime" : 1520931238,
    "last_content_update" : 1520931238807,
    "path" : "~/R_Projects/page_destructure/Rfile/Rvest.R",
    "project_path" : "Rfile/Rvest.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}