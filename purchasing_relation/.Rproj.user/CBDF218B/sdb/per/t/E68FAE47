{
    "contents" : "item = factor(c(\"A\",\"B\",\"B\",\"A\",\"B\",\"A\",\"C\",\"A\",\"B\",\"C\",\"B\",\"A\",\"B\",\"A\",\"A\",\"B\",\"A\",\"B\"))\nseqid = c(rep(1,5),rep(2,6),rep(3,3),rep(4,4))\neventids = c(10,15,20,30,35,20,25,30,35,40,50,10,30,40,30,35,40,50)\n\ndata = data.frame(item = item)\ndata.tran = as(data,\"transactions\")\ntransactionInfo(data.tran)$sequenceID = seqid\ntransactionInfo(data.tran)$eventID = eventids\n\nresult = cspade(data.tran,parameter = list(support = 0.5),control = list(verbose = TRUE))\nresult = sort(result,by = \"support\")\ninspect(result)\n\nresult.1 = result[grep(\".*item=B.*\",as(result,\"data.frame\")$sequence)]\nresult.2 = result[grep(\".*item=B[^\\\\}]*\\\\}>\",as(result,\"data.frame\")$sequence)]\nresult.3 = result[grep(\"<\\\\{[^\\\\}]*item=B.*\",as(result,\"data.frame\")$sequence)]\n\n#网页访问的例子\ntmpp = read.fwf(\"~/data/anonymous-msweb.test\",widths = c(60))\ntrain_list = tmpp$V1\n\ntmp_page = c(0)\ntmp_sequenceid = c(0)\ntmp_eventid = c(0)\nm = 0\nsequenceid = 0\ntrain_length = length(train_list)\n\nfor(i in 302:train_length){\n  tmp = unlist(strsplit(as.character(train_list[i]),\",\"))\n  if(tmp[1]==\"C\"){\n    sequenceid = sequenceid + 1\n    eventid = 0\n  }\n  else if(tmp[1]==\"V\"){\n    m = m+1\n    eventid = eventid + 1\n    tmp_sequenceid[m] = sequenceid\n    tmp_eventid[m] = eventid\n    tmp_page[m] = as.numeric(tmp[2])\n  }\n}\ntmp_page = factor(tmp_page)\ndata = data.frame(page = tmp_page,seqid = tmp_sequenceid,eventid = tmp_eventid)\n\ndata$seqid[which(data$page == 1034)]\n\nuser.page = 1034\n\n# data.user = data[data$seqid == unique(data$seqid[which(data$page==user.page)]),]\ndata.user = data[data$seqid %in% unique(data$seqid[which(data$page==user.page)]),]\ntmp_data = data.frame(page=data.user$page)\ndata.tran = as(tmp_data,\"transactions\")\ntransactionInfo(data.tran)$sequenceID = data.user$seqid\ntransactionInfo(data.tran)$eventID = data.user$eventid\n\nresult = cspade(data.tran,parameter = list(support = 0,maxlen = 2),control = list(verbose = TRUE))\nresult = sort(result,by = \"support\")\ninspect(result)\nresult.2 = result[grep(paste0(\".*page=\",user.page,\"[^\\\\}]*\\\\}>\"),as(result,\"data.frame\")$sequence)]\n\nresult.data.frame = as(result.2[-1],\"data.frame\")\npersent = result.data.frame$support/sum(result.data.frame$support)\nsum.persent = cumsum(persent)\nresult.data.frame = cbind(result.data.frame,persent,sum.persent)\n\npage = 0;i=1\nfor(i.seq in result.data.frame$sequence){\n  real_seq1 = regexpr(\"<\\\\{page=\",i.seq)[1]+7\n  real_seq2 = regexpr(\"\\\\}\",i.seq)[1]-1\n  page[i] = substr(i.seq,real_seq1,real_seq2)\n  i = i+1\n}\n\ni=1;uv=0\nfor(i.page in page){\n  uv[i]=length(unique(data$seqid[which(data$page==i.page)]))\n  i=i+1\n}\n\nconf=result.data.frame$support*result@info$nsequences/uv\n\nresult.data.frame = cbind(result.data.frame,conf=conf,page=page)\nresult.data.frame = result.data.frame[1:165,]\n#作图研究\nbarplot(as.matrix(result.data.frame[1:20,]$persent,nrow = 1),ylim = c(0,1),beside = TRUE,xlab =\"page name\",main = \"ability to introduce user to page 1034\")\nlines(0.5+1:nrow(result.data.frame[1:20,]),result.data.frame[1:20,]$conf,col = \"red\",type = \"b\")\ntext(0.5+1:nrow(result.data.frame[1:20,]),result.data.frame[1:20,]$conf,labels = paste0(round(result.data.frame[1:20,]$conf*100,2),\"%\"))\naxis(1,at=0.5+1:nrow(result.data.frame[1:20,]),labels = result.data.frame[1:20,]$page,tick = F)\n",
    "created" : 1499070976957.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "773338418",
    "id" : "E68FAE47",
    "lastKnownWriteTime" : 1499137757,
    "path" : "~/R_Projects/purchasing_relation/Rfile/arules_sequence2.R",
    "project_path" : "Rfile/arules_sequence2.R",
    "properties" : {
    },
    "relative_order" : 5,
    "source_on_save" : false,
    "type" : "r_source"
}